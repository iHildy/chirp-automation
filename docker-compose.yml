services:
  chirp-automation:
    platform: linux/amd64
    build:
      context: .
      dockerfile: docker/Dockerfile
    ports:
      - "8080:8080"
      - "6080:6080"
    environment:
      API_TOKEN: "${API_TOKEN:-change-me}"
      PORT: "8080"
      ADB_SERIAL: "${ADB_SERIAL:-emulator-5554}"
      ADB_CONNECT: "${ADB_CONNECT:-}"
      ACTIONS_PATH: "/opt/chirp/config/actions.yaml"
      ARTIFACTS_DIR: "/opt/chirp/data/artifacts"
      EMULATOR_DEVICE: "${EMULATOR_DEVICE:-Nexus 5}"
      WEB_VNC: "true"
      SKIP_EMULATOR_START: "${SKIP_EMULATOR_START:-false}"
    volumes:
      - ./config:/opt/chirp/config
      - ./data:/opt/chirp/data
      - avd-data:/home/androidusr/.android/avd
    devices:
      - /dev/kvm
    privileged: true

volumes:
  avd-data:
